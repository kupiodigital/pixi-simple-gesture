'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = pinchable;
function pinchable(sprite, inertia) {

  function start(e) {
    sprite.on('touchmove', move);
  }

  function move(e) {
    if (!e.data.originalEvent.targetTouches) {
      return;
    }

    var t = e.data.originalEvent.targetTouches;
    if (!t || t.length < 2) {
      return;
    }
    var dx = t[0].clientX - t[1].clientX;
    var dy = t[0].clientY - t[1].clientY;
    var distance = Math.sqrt(dx * dx + dy * dy);
    if (!sprite._pinch) {
      sprite._pinch = {
        p: {
          distance: distance,
          date: new Date()
        }
      };
      sprite.emit('pinchstart');
      return;
    }
    var now = new Date();
    var interval = now - sprite._pinch.p.date;
    if (interval < 12) {
      return;
    }
    var center = {
      x: (t[0].clientX + t[1].clientX) / 2,
      y: (t[0].clientY + t[1].clientY) / 2
    };
    var event = {
      scale: distance / sprite._pinch.p.distance,
      velocity: distance / interval,
      center: center,
      data: e.data
    };
    sprite.emit('pinchmove', event);
    sprite._pinch.pp = {
      distance: sprite._pinch.p.distance,
      date: sprite._pinch.p.date
    };
    sprite._pinch.p = {
      distance: distance,
      date: now
    };
  }

  function end(e) {
    sprite.removeListener('touchmove', move);
    if (!sprite._pinch) {
      return;
    }
    if (inertia && sprite._pinch.pp) {
      if (sprite._pinch.intervalId) {
        return;
      }
      var interval = new Date() - sprite._pinch.p.date;
      var velocity = (sprite._pinch.p.distance - sprite._pinch.pp.distance) / interval;
      var center = sprite._pinch.p.center;
      var distance = sprite._pinch.p.distance;
      sprite._pinch.intervalId = setInterval(function () {
        if (Math.abs(velocity) < 0.04) {
          clearInterval(sprite._pinch.intervalId);
          sprite.emit('pinchend');
          sprite._pinch = null;
          return;
        }
        var updatedDistance = distance + velocity * 12;
        var event = {
          scale: updatedDistance / distance,
          velocity: velocity,
          center: center,
          data: e.data
        };
        sprite.emit('pinchmove', event);
        distance = updatedDistance;
        velocity *= 0.8;
      }, 12);
    } else {
      sprite.emit('pinchend');
      sprite._pinch = null;
    }
  }

  sprite.interactive = true;
  sprite.on('touchstart', start).on('touchend', end).on('touchendoutside', end);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9nZXN0dXJlcy9waW5jaC5qcyJdLCJuYW1lcyI6WyJwaW5jaGFibGUiLCJzcHJpdGUiLCJpbmVydGlhIiwic3RhcnQiLCJlIiwib24iLCJtb3ZlIiwiZGF0YSIsIm9yaWdpbmFsRXZlbnQiLCJ0YXJnZXRUb3VjaGVzIiwidCIsImxlbmd0aCIsImR4IiwiY2xpZW50WCIsImR5IiwiY2xpZW50WSIsImRpc3RhbmNlIiwiTWF0aCIsInNxcnQiLCJfcGluY2giLCJwIiwiZGF0ZSIsIkRhdGUiLCJlbWl0Iiwibm93IiwiaW50ZXJ2YWwiLCJjZW50ZXIiLCJ4IiwieSIsImV2ZW50Iiwic2NhbGUiLCJ2ZWxvY2l0eSIsInBwIiwiZW5kIiwicmVtb3ZlTGlzdGVuZXIiLCJpbnRlcnZhbElkIiwic2V0SW50ZXJ2YWwiLCJhYnMiLCJjbGVhckludGVydmFsIiwidXBkYXRlZERpc3RhbmNlIiwiaW50ZXJhY3RpdmUiXSwibWFwcGluZ3MiOiI7Ozs7O2tCQUF3QkEsUztBQUFULFNBQVNBLFNBQVQsQ0FBbUJDLE1BQW5CLEVBQTJCQyxPQUEzQixFQUFvQzs7QUFFakQsV0FBU0MsS0FBVCxDQUFlQyxDQUFmLEVBQWtCO0FBQ2hCSCxXQUFPSSxFQUFQLENBQVUsV0FBVixFQUF1QkMsSUFBdkI7QUFDRDs7QUFFRCxXQUFTQSxJQUFULENBQWNGLENBQWQsRUFBaUI7QUFDZixRQUFJLENBQUNBLEVBQUVHLElBQUYsQ0FBT0MsYUFBUCxDQUFxQkMsYUFBMUIsRUFBeUM7QUFDdkM7QUFDRDs7QUFFRCxRQUFJQyxJQUFJTixFQUFFRyxJQUFGLENBQU9DLGFBQVAsQ0FBcUJDLGFBQTdCO0FBQ0EsUUFBSSxDQUFDQyxDQUFELElBQU1BLEVBQUVDLE1BQUYsR0FBVyxDQUFyQixFQUF3QjtBQUN0QjtBQUNEO0FBQ0QsUUFBSUMsS0FBS0YsRUFBRSxDQUFGLEVBQUtHLE9BQUwsR0FBZUgsRUFBRSxDQUFGLEVBQUtHLE9BQTdCO0FBQ0EsUUFBSUMsS0FBS0osRUFBRSxDQUFG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QURmO0FBRVZlLG9CQUFVQSxRQUZBO0FBR1ZMLGtCQUFRQSxNQUhFO0FBSVZuQixnQkFBTUgsRUFBRUc7QUFKRSxTQUFaO0FBTUFOLGVBQU9zQixJQUFQLENBQVksV0FBWixFQUF5Qk0sS0FBekI7QUFDQWIsbUJBQVd1QixlQUFYO0FBQ0FSLG9CQUFZLEdBQVo7QUFDRCxPQWpCMEIsRUFpQnhCLEVBakJ3QixDQUEzQjtBQWtCRCxLQTFCRCxNQTBCTztBQUNMOUIsYUFBT3NCLElBQVAsQ0FBWSxVQUFaO0FBQ0F0QixhQUFPa0IsTUFBUCxHQUFnQixJQUFoQjtBQUNEO0FBQ0Y7O0FBRURsQixTQUFPdUMsV0FBUCxHQUFxQixJQUFyQjtBQUNBdkMsU0FDR0ksRUFESCxDQUNNLFlBRE4sRUFDb0JGLEtBRHBCLEVBRUdFLEVBRkgsQ0FFTSxVQUZOLEVBRWtCNEIsR0FGbEIsRUFHRzVCLEVBSEgsQ0FHTSxpQkFITixFQUd5QjRCLEdBSHpCO0FBSUQiLCJmaWxlIjoicGluY2guanMiLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBwaW5jaGFibGUoc3ByaXRlLCBpbmVydGlhKSB7XHJcblxyXG4gIGZ1bmN0aW9uIHN0YXJ0KGUpIHtcclxuICAgIHNwcml0ZS5vbigndG91Y2htb3ZlJywgbW92ZSlcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIG1vdmUoZSkge1xyXG4gICAgaWYgKCFlLmRhdGEub3JpZ2luYWxFdmVudC50YXJnZXRUb3VjaGVzKSB7XHJcbiAgICAgIHJldHVyblxyXG4gICAgfVxyXG5cclxuICAgIGxldCB0ID0gZS5kYXRhLm9yaWdpbmFsRXZlbnQudGFyZ2V0VG91Y2hlc1xyXG4gICAgaWYgKCF0IHx8IHQubGVuZ3RoIDwgMikge1xyXG4gICAgICByZXR1cm5cclxuICAgIH1cclxuICAgIGxldCBkeCA9IHRbMF0uY2xpZW50WCAtIHRbMV0uY2xpZW50WFxyXG4gICAgbGV0IGR5ID0gdFswXS5jbGllbnRZIC0gdFsxXS5jbGllbnRZXHJcbiAgICBsZXQgZGlzdGFuY2UgPSBNYXRoLnNxcnQoZHggKiBkeCArIGR5ICogZHkpXHJcbiAgICBpZiAoIXNwcml0ZS5fcGluY2gpIHtcclxuICAgICAgc3ByaXRlLl9waW5jaCA9IHtcclxuICAgICAgICBwOiB7XHJcbiAgICAgICAgICBkaXN0YW5jZTogZGlzdGFuY2UsXHJcbiAgICAgICAgICBkYXRlOiBuZXcgRGF0ZSgpXHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICAgIHNwcml0ZS5lbWl0KCdwaW5jaHN0YXJ0JylcclxuICAgICAgcmV0dXJuXHJcbiAgICB9XHJcbiAgICBsZXQgbm93ID0gbmV3IERhdGUoKVxyXG4gICAgbGV0IGludGVydmFsID0gbm93IC0gc3ByaXRlLl9waW5jaC5wLmRhdGVcclxuICAgIGlmIChpbnRlcnZhbCA8IDEyKSB7XHJcbiAgICAgIHJldHVyblxyXG4gICAgfVxyXG4gICAgbGV0IGNlbnRlciA9IHtcclxuICAgICAgeDogKHRbMF0uY2xpZW50WCArIHRbMV0uY2xpZW50WCkgLyAyLFxyXG4gICAgICB5OiAodFswXS5jbGllbnRZICsgdFsxXS5jbGllbnRZKSAvIDJcclxuICAgIH1cclxuICAgIGxldCBldmVudCA9IHtcclxuICAgICAgc2NhbGU6IGRpc3RhbmNlIC8gc3ByaXRlLl9waW5jaC5wLmRpc3RhbmNlLFxyXG4gICAgICB2ZWxvY2l0eTogZGlzdGFuY2UgLyBpbnRlcnZhbCxcclxuICAgICAgY2VudGVyOiBjZW50ZXIsXHJcbiAgICAgIGRhdGE6IGUuZGF0YVxyXG4gICAgfVxyXG4gICAgc3ByaXRlLmVtaXQoJ3BpbmNobW92ZScsIGV2ZW50KVxyXG4gICAgc3ByaXRlLl9waW5jaC5wcCA9IHtcclxuICAgICAgZGlzdGFuY2U6IHNwcml0ZS5fcGluY2gucC5kaXN0YW5jZSxcclxuICAgICAgZGF0ZTogc3ByaXRlLl9waW5jaC5wLmRhdGVcclxuICAgIH1cclxuICAgIHNwcml0ZS5fcGluY2gucCA9IHtcclxuICAgICAgZGlzdGFuY2U6IGRpc3RhbmNlLFxyXG4gICAgICBkYXRlOiBub3dcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIGVuZChlKSB7XHJcbiAgICBzcHJpdGUucmVtb3ZlTGlzdGVuZXIoJ3RvdWNobW92ZScsIG1vdmUpXHJcbiAgICBpZiAoIXNwcml0ZS5fcGluY2gpIHtcclxuICAgICAgcmV0dXJuXHJcbiAgICB9XHJcbiAgICBpZiAoaW5lcnRpYSAmJiBzcHJpdGUuX3BpbmNoLnBwKSB7XHJcbiAgICAgIGlmIChzcHJpdGUuX3BpbmNoLmludGVydmFsSWQpIHtcclxuICAgICAgICByZXR1cm5cclxuICAgICAgfVxyXG4gICAgICBsZXQgaW50ZXJ2YWwgPSBuZXcgRGF0ZSgpIC0gc3ByaXRlLl9waW5jaC5wLmRhdGVcclxuICAgICAgbGV0IHZlbG9jaXR5ID0gKHNwcml0ZS5fcGluY2gucC5kaXN0YW5jZSAtIHNwcml0ZS5fcGluY2gucHAuZGlzdGFuY2UpIC8gaW50ZXJ2YWxcclxuICAgICAgbGV0IGNlbnRlciA9IHNwcml0ZS5fcGluY2gucC5jZW50ZXJcclxuICAgICAgbGV0IGRpc3RhbmNlID0gc3ByaXRlLl9waW5jaC5wLmRpc3RhbmNlXHJcbiAgICAgIHNwcml0ZS5fcGluY2guaW50ZXJ2YWxJZCA9IHNldEludGVydmFsKCgpID0+IHtcclxuICAgICAgICBpZiAoTWF0aC5hYnModmVsb2NpdHkpIDwgMC4wNCkge1xyXG4gICAgICAgICAgY2xlYXJJbnRlcnZhbChzcHJpdGUuX3BpbmNoLmludGVydmFsSWQpXHJcbiAgICAgICAgICBzcHJpdGUuZW1pdCgncGluY2hlbmQnKVxyXG4gICAgICAgICAgc3ByaXRlLl9waW5jaCA9IG51bGxcclxuICAgICAgICAgIHJldHVyblxyXG4gICAgICAgIH1cclxuICAgICAgICBsZXQgdXBkYXRlZERpc3RhbmNlID0gZGlzdGFuY2UgKyB2ZWxvY2l0eSAqIDEyXHJcbiAgICAgICAgbGV0IGV2ZW50ID0ge1xyXG4gICAgICAgICAgc2NhbGU6IHVwZGF0ZWREaXN0YW5jZSAvIGRpc3RhbmNlLFxyXG4gICAgICAgICAgdmVsb2NpdHk6IHZlbG9jaXR5LFxyXG4gICAgICAgICAgY2VudGVyOiBjZW50ZXIsXHJcbiAgICAgICAgICBkYXRhOiBlLmRhdGFcclxuICAgICAgICB9XHJcbiAgICAgICAgc3ByaXRlLmVtaXQoJ3BpbmNobW92ZScsIGV2ZW50KVxyXG4gICAgICAgIGRpc3RhbmNlID0gdXBkYXRlZERpc3RhbmNlXHJcbiAgICAgICAgdmVsb2NpdHkgKj0gMC44XHJcbiAgICAgIH0sIDEyKVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgc3ByaXRlLmVtaXQoJ3BpbmNoZW5kJylcclxuICAgICAgc3ByaXRlLl9waW5jaCA9IG51bGxcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHNwcml0ZS5pbnRlcmFjdGl2ZSA9IHRydWVcclxuICBzcHJpdGVcclxuICAgIC5vbigndG91Y2hzdGFydCcsIHN0YXJ0KVxyXG4gICAgLm9uKCd0b3VjaGVuZCcsIGVuZClcclxuICAgIC5vbigndG91Y2hlbmRvdXRzaWRlJywgZW5kKVxyXG59XHJcbiJdfQ==